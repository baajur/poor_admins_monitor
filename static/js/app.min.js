const COLOURS=["#ce4d3e","#64ac48","#7263cc","#9a963f","#bc69c0","#4aac8b","#d04287","#c88441","#698ecd","#c0687c"];let currentColour=0;const canvas=document.getElementById("chart"),ctx=canvas.getContext("2d"),devices=document.querySelectorAll("[data-device-id]");let chartjs;function removeTrack(e){const t=document.querySelector(`[data-device-id="${e}"]`);t.classList.remove("is-active"),t.style.color="";let a=0;for(let e of chartjs.data.datasets)e.label===t.text&&chartjs.data.datasets.splice(a,1),a++;chartjs.update()}function addTrack(e,t){const a=document.querySelector(`[data-device-id="${e}"]`);fetch(`/api/v1/device/get/${e}/history?minutes=1000`).then(e=>e.json()).then(e=>{if(t){for(let e of devices)e.classList.remove("is-active");chartjs.data={datasets:[]}}a.classList.add("is-active");let c={label:a.text,fill:!1,data:[]};for(let t of e.device.history)c.data.unshift({x:t.ts,y:t.t});let s=!1;for(let e of chartjs.data.datasets)e.label===c.label&&(e.data=c.data,s=!0);s||(c.pointColor=COLOURS[currentColour++%COLOURS.length],c.backgroundColor=c.pointColor,c.borderColor=c.pointColor,a.style.color=c.pointColor,chartjs.data.datasets.push(c)),chartjs.options.legend.display=chartjs.width>768,chartjs.update()})}chartjs=new Chart(ctx,{type:"line",data:{},options:{maintainAspectRatio:!1,onResize:(e,t)=>{console.log(e,t),e.options.legend.display=t.width>768,e.update()},legend:{},scales:{xAxes:[{type:"time",time:{unit:"minute",stepSize:1},scaleLabel:{display:!0,labelString:"Time"}}],yAxes:[{scaleLabel:{display:!0,labelString:"Temperature (Â°C)"},ticks:{suggestedMin:15,suggestedMax:30}}]},elements:{point:{radius:0}}}});for(let e of document.querySelectorAll("[data-device-id]"))e.addEventListener("click",e=>{e.target.classList.contains("is-active")?removeTrack(e.target.dataset.deviceId):addTrack(e.target.dataset.deviceId,!1),e.preventDefault()});const layout=document.getElementById("layout"),menu=document.getElementById("menu"),menuLink=document.getElementById("menuLink"),content=document.getElementById("main");function toggleAll(e){e.preventDefault(),layout.classList.toggle("active"),menu.classList.toggle("active"),menuLink.classList.toggle("active")}menuLink.addEventListener("click",toggleAll),content.addEventListener("click",e=>{menu.classList.contains("active")&&toggleAll(e)});